{% extends '::base.html.twig' %}
{% block contenu %}
<div class="container-fluid page-container">
    <div class="row">
        <div class="sidebar content-tab col-sm-12 col-md-3 col-lg-3">
{{ form_start(form, {'attr': {'class': 'form-horizontal'} }) }}
{{ form_errors(form) }}
            <div class="form-group">{{ form_label(form.anneetaxation, "Année de taxation : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.anneetaxation,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.anneetaxation,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>
            </div>
            <div class="form-group">{{ form_label(form.nompersonne, "Nom de la personne : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.nompersonne, {'attr': {'class': 'form-control','data-url': path('fiscalite_ajaxNompersonne')} }) }}
{{ form_errors(form.nompersonne,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>        
            </div>
            <div class="form-group">{{ form_label(form.nbpersonnesacharge, "Nombre de personnes à charge : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.nbpersonnesacharge,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.nbpersonnesacharge,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group">{{ form_label(form.basenettemin, "Base nette commune : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.basenettemin,{ 'attr': { 'class': 'col-sm-4' } }) }}
{{ form_label(form.basenettemax, "à",{ 'label_attr': { 'class': 'col-sm-4' } }) }}
{{ form_widget(form.basenettemax,{ 'attr': { 'class': 'col-sm-4' } }) }}
{{ form_errors(form.basenettemin,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.basenettemax,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group">{{ form_label(form.abattementgeneralbasecommunale, "Abattement général base communal : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.abattementgeneralbasecommunale,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.abattementgeneralbasecommunale,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group">{{ form_label(form.abattementpersonneschargecommunnal, "Abattement personnes à charge communal : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.abattementpersonneschargecommunnal,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.abattementpersonneschargecommunnal,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group">{{ form_label(form.abattementspecialbasecommunal, "Abattement spécial à la base communal : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.abattementspecialbasecommunal,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.abattementspecialbasecommunal,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group">{{ form_label(form.abattementspecialhandicapecommunal, "Abattement spécial handicapé communal : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.abattementspecialhandicapecommunal,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.abattementspecialhandicapecommunal,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>                
            </div>
            <div class="form-group ">{{ form_label(form.cotisationcommunalemin, "Cotisation commune : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}
                <div class="col-sm-6">
{{ form_widget(form.cotisationcommunalemin,{ 'attr': { 'class': 'col-sm-4' } }) }}
{{ form_label(form.cotisationcommunalemax, "à",{ 'label_attr': { 'class': 'col-sm-4' } }) }}
{{ form_widget(form.cotisationcommunalemax,{ 'attr': { 'class': 'col-sm-4' } }) }}  
{{ form_errors(form.cotisationcommunalemin,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.cotisationcommunalemax,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>
            </div>
            <div class="form-group ">{{ form_label(form.montantnetapayermin, "Montant net à payer : ",{ 'label_attr': { 'class': 'col-sm-6' } }) }}           
                <div class="col-sm-6">
{{ form_widget(form.montantnetapayermin,{ 'attr': { 'class': 'col-sm-4' } }) }}
{{ form_label(form.montantnetapayermax, "à",{ 'label_attr': { 'class': 'col-sm-4' } }) }}
{{ form_widget(form.montantnetapayermax,{ 'attr': { 'class': 'col-sm-4' } }) }}
{{ form_errors(form.montantnetapayermin,{ 'attr': { 'class': 'col-sm-12' } }) }}
{{ form_errors(form.montantnetapayermax,{ 'attr': { 'class': 'col-sm-12' } }) }}
                </div>
            </div>
            <div class="col-sm-offset-1 col-sm-2">
{{ form_end(form , {'attr': {'class': 'btn btn-default'} }) }}
            </div> 
        </div>
        <div class="content-tab col-sm-12 col-md-12  col-lg-8">
            <div> <h5>{{ "Résultat : "~ pagination.getTotalItemCount ~" article(s) trouvé(s)."}}</h5></div>
            <table class="table table-striped table-hover ">
                <thead>
                    <tr>
                        <th class="text-center">Année</th><th  class="text-center">{{ knp_pagination_sortable(pagination, 'Nom Prenom', 'a.nomprenom') }}</th>
                        <th class="text-center">Adresse</th><th class="text-center">Base nette</th>
                        <th class="text-center">Abattement total Communale</th><th class="text-center">Cotisation Communale</th>
                        <th class="text-center">Montant net à payer</th>
                    </tr>
                </thead>
                <tbody> {% for articleTH in pagination %}

                    <tr>
                        <td class="text-right">{{articleTH.getFichier().getAnneeTaxation()}}</td>
                        <td class="text-right"><a href="{{ path('articleTH',{'id': articleTH.getNumerosequentiel()}) }}">{{articleTH.getNomprenom() ~ articleTH.getSuitenom()}}</a></td>
                        <td class="text-right">{% if articleTH.getAdresse() == NULL %}
                            {{"Non renseigné"}}
                        {%else%} 
                            {%if articleTH.adresse.numeroimmeubleaft=="0000" %}
                                {{articleTH.adresse.libellevoieaft }}
                            {%else%}
                                {{articleTH.adresse.numeroimmeubleaft ~" "~articleTH.adresse.libellevoieaft }}
                            {%endif %}
                        {% endif %}</td>
                        <td class="text-right">{% if articleTH.getBase().getBasenettecommunale() == NULL %}
                            {{"0 €"}}
                        {%else%} 
                            {{articleTH.getBase().getBasenettecommunale()|number_format(0, ',', ' ') ~" €"}}
                        {% endif %}</td>
                        <td class="text-right">{% if articleTH.getAbattement() == NULL %}
                            {{"0"}}
                        {%else%} 
                            {{(articleTH.getAbattement().getAbattementgeneralbasecommunale()+
                                articleTH.getAbattement().getAbattementpersonneschargecommunnal()+
                                articleTH.getAbattement().getAbattementspecialbasecommunal()+
                                articleTH.getAbattement().getAbattementspecialhandicapecommunal())|number_format(0, ',', ' ')}}
                        {% endif %}
                            €</td>
                        <td class="text-right">{% if articleTH.getCotisation().getCotisationcommunale() == NULL %}
                            {{"0"}}
                        {%else%} 
                            {{articleTH.getCotisation().getCotisationcommunale()|number_format(0, ',', ' ')}}
                        {% endif %}
                            €</td>
                        <td class="text-right">{% if articleTH.getMontantnetapayer() == NULL %}
                            {{"0 €"}}
                        {%else%} 
                            {{articleTH.getMontantnetapayer()|number_format(0, ',', ' ') ~ '€'}}
                        {% endif %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <div class="navigation pagination">
                {{ knp_pagination_render(pagination,null, {}, {'alignment': 'center'}) }}
            </div>
        </div>    
    </div>
</div>                      
<script>
    $(document).ready(function() {
        var attr = $('#fiscalite_gestionfiscalitebundle_recherchearticleth_nompersonne').attr('data-url');
        $("#fiscalite_gestionfiscalitebundle_recherchearticleth_nompersonne").autocomplete({
            minLength: 2,
            source: attr
        });
    });
</script>         
{% endblock %}
{% block footer %}
{{ parent() }}
{% endblock %}